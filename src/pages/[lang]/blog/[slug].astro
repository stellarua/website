---

import BlogPostLayout from '../../../layouts/BlogPostLayout.astro';
import { contentfulClient } from '../../../contentful/contentful';
import { documentToHtmlString } from '@contentful/rich-text-html-renderer';
import {type BlogPost} from "../../../contentful/types"

export async function getStaticPaths() {

  const locales = ['en-US', 'uk'];
  let paths:  Array<{ params: { slug: string, lang: string }, props: any }> = [];

  for (const locale of locales) {
    const { items } = await contentfulClient.getEntries<BlogPost>({
      content_type: 'blogPost',
      locale,
    });

    items.forEach((item: any) => {
      const { photo, slug, mainText } = item.fields;
      const imgUrl = photo?.fields?.file?.url || '';
      console.log(photo)
      paths.push({
        params: { slug, lang: locale },
        props: {
          ...item.fields,
          mainText: documentToHtmlString(mainText),
          photo: imgUrl,
          photoTitle: photo?.fields?.title
        },
      });
    });
  }
  return paths;
}


const props = Astro.props;
---

<BlogPostLayout {...props}>
  <article set:html={props.mainText} />
</BlogPostLayout>